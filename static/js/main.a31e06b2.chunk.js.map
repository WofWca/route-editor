{"version":3,"sources":["App.js","index.js"],"names":["ymaps","window","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","handlePointListItemDragEnd","event","_draggedPoint","handlePointListItemDragStart","draggedPoint","handlePointListItemDrop","dropOntoPoint","setState","state","newStatePoints","points","slice","dropOntoPointInd","indexOf","draggedPointInd","splice","handleNewPointSubmit","preventDefault","newPointName","newPointId","nextPointId","newYmapsPoint","GeoObject","geometry","type","coordinates","map","getCenter","properties","balloonContent","draggable","events","add","mapRefreshRoute","geoObjects","push","id","name","ymapsObj","routeCoordinates","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","pointCoordinates","value","getBounds","err","return","ymapsRouteObj","setCoordinates","handleNewPointNameChange","target","mapReady","newPointNameInput","React","createRef","_this2","react_default","a","createElement","className","onSubmit","disabled","required","autoFocus","placeholder","onChange","ref","point","key","onDragStart","e","onDragOver","allowDrop","onDrop","onDragEnd","_this3","ready","Map","center","zoom","Polyline","current","focus","prevProps","prevState","snapshot","Component","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.a31e06b2.chunk.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport \"./App.css\";\r\nconst ymaps = window.ymaps;\r\n\r\nclass App extends Component {\r\n  constructor (props) {\r\n    super(props);\r\n    this.state = {\r\n      newPointName: \"\",\r\n      /* `points` item structure: {\r\n          id,\r\n          name,\r\n          ymapsObj: Yandex Maps GeoObject\r\n      } */\r\n      points: [],\r\n      mapReady: false\r\n    };\r\n    this.map = undefined;\r\n    this.nextPointId = 1;\r\n    this.ymapsRouteObj = undefined;\r\n    this.newPointNameInput = React.createRef();\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"App\">\r\n        <div className=\"points-editor\">\r\n          <form onSubmit={this.handleNewPointSubmit}>\r\n            <legend>New waypoint</legend>\r\n            <input\r\n              disabled={!this.state.mapReady}\r\n              required\r\n              autoFocus\r\n              type=\"text\"\r\n              placeholder=\"Name\"\r\n              value={this.state.newPointName}\r\n              onChange={this.handleNewPointNameChange}\r\n              ref={this.newPointNameInput}\r\n            />\r\n          </form>\r\n          <ol className=\"points-list\">\r\n            {this.state.points.map((point) => (\r\n              <li\r\n                key={point.id}\r\n                draggable\r\n                onDragStart={(e) => this.handlePointListItemDragStart(point)}\r\n                onDragOver={this.allowDrop}\r\n                onDrop={(e) => this.handlePointListItemDrop(point)}\r\n                onDragEnd={this.handlePointListItemDragEnd}\r\n                className=\"point\"\r\n              >\r\n                {point.name}</li>\r\n            ))}\r\n          </ol>\r\n        </div>\r\n        <div id=\"map\" className=\"map\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  handlePointListItemDragEnd = (event) => {\r\n    this._draggedPoint = null;\r\n  }\r\n\r\n  handlePointListItemDragStart = (draggedPoint) => {\r\n    this._draggedPoint = draggedPoint;\r\n  }\r\n\r\n  handlePointListItemDrop = (dropOntoPoint) => {\r\n    if (this._draggedPoint) {\r\n      this.setState((state, props) => {\r\n        const newStatePoints = state.points.slice();\r\n        const dropOntoPointInd = state.points.indexOf(dropOntoPoint);\r\n        const draggedPointInd = state.points.indexOf(this._draggedPoint);\r\n        newStatePoints.splice(draggedPointInd, 1);\r\n        newStatePoints.splice(dropOntoPointInd, 0, this._draggedPoint);\r\n        return { points: newStatePoints };\r\n      });\r\n    }\r\n  }\r\n\r\n  allowDrop (event) {\r\n    event.preventDefault();\r\n  }\r\n\r\n  componentDidMount() {\r\n    const ymapsInit = () => {\r\n      this.setState({mapReady: true});\r\n      this.map = new ymaps.Map(\"map\", {\r\n        center: [55.76, 37.64],\r\n        zoom: 10\r\n      });\r\n      this.ymapsRouteObj = new ymaps.Polyline([55.76, 37.64]);\r\n      this.map.geoObjects.add(this.ymapsRouteObj);\r\n      this.map.events.add(\"actionbegin\", () => {\r\n        this.newPointNameInput.current.focus();\r\n      });\r\n    };\r\n    ymaps.ready(ymapsInit);\r\n  }\r\n\r\n  handleNewPointSubmit = (event) => {\r\n    event.preventDefault();\r\n\r\n    const newPointName = this.state.newPointName;\r\n    this.setState((state, props) => {\r\n      let newStatePoints = state.points.slice();\r\n      const newPointId = this.nextPointId;\r\n      this.nextPointId++;\r\n      let newYmapsPoint = new ymaps.GeoObject({\r\n        geometry: {\r\n          type: \"Point\",\r\n          coordinates: this.map.getCenter()\r\n        },\r\n        properties: {\r\n          balloonContent: newPointName\r\n        }\r\n      }, { draggable: true }\r\n      );\r\n      newYmapsPoint.events.add(\"geometrychange\", () => {\r\n        // TODO the route flickers when we move points around. Fix it?\r\n        this.mapRefreshRoute();\r\n      });\r\n      this.map.geoObjects.add(newYmapsPoint);\r\n      newStatePoints.push(\r\n        {\r\n          id: newPointId,\r\n          name: newPointName,\r\n          ymapsObj: newYmapsPoint\r\n        }\r\n      );\r\n      return { points: newStatePoints, newPointName: \"\" };\r\n    });\r\n  }\r\n\r\nmapRefreshRoute = () => {\r\n    const routeCoordinates = [];\r\n    for (let point of this.state.points) {\r\n      // For a point, its bounds is a 0 area rectangle.\r\n      let pointCoordinates = point.ymapsObj.geometry.getBounds()[0];\r\n      routeCoordinates.push(pointCoordinates);\r\n    }\r\n    this.ymapsRouteObj.geometry.setCoordinates(routeCoordinates);\r\n  }\r\n\r\n  handleNewPointNameChange = (event) => {\r\n    this.setState({ newPointName: event.target.value });\r\n  }\r\n\r\n  componentDidUpdate (prevProps, prevState, snapshot) {\r\n    if (this.state.points !== prevState.points) {\r\n      this.mapRefreshRoute();\r\n    }\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}