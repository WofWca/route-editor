{"version":3,"sources":["App.js","index.js"],"names":["ymaps","window","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","handlePointListItemDragEnd","event","_draggedPoint","handlePointListItemDragStart","draggedPoint","dataTransfer","setData","console","log","handlePointListItemDrop","dropOntoPoint","setState","state","newStatePoints","points","slice","dropOntoPointInd","indexOf","draggedPointInd","splice","handleNewPointSubmit","preventDefault","newPointName","newPointId","nextPointId","newYmapsPoint","GeoObject","geometry","type","coordinates","map","getCenter","properties","balloonContent","draggable","events","add","mapRefreshRoute","geoObjects","push","id","name","ymapsObj","routeCoordinates","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","pointCoordinates","value","getBounds","err","return","ymapsRouteObj","setCoordinates","handleNewPointNameChange","target","mapReady","newPointNameInput","React","createRef","_this2","react_default","a","createElement","className","onSubmit","disabled","required","autoFocus","placeholder","onChange","ref","point","key","onDragStart","e","onDragOver","allowDrop","onDrop","onDragEnd","_this3","ready","Map","center","zoom","Polyline","current","focus","prevProps","prevState","snapshot","Component","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.e47d90aa.chunk.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport \"./App.css\";\r\nconst ymaps = window.ymaps;\r\n\r\nclass App extends Component {\r\n  constructor (props) {\r\n    super(props);\r\n    this.state = {\r\n      newPointName: \"\",\r\n      /* `points` item structure: {\r\n          id,\r\n          name,\r\n          ymapsObj: Yandex Maps GeoObject\r\n      } */\r\n      points: [],\r\n      mapReady: false\r\n    };\r\n    this.map = undefined;\r\n    this.nextPointId = 1;\r\n    this.ymapsRouteObj = undefined;\r\n    this.newPointNameInput = React.createRef();\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"App\">\r\n        <div className=\"points-editor\">\r\n          <form onSubmit={this.handleNewPointSubmit}>\r\n            <legend>New waypoint</legend>\r\n            <input\r\n              disabled={!this.state.mapReady}\r\n              required\r\n              autoFocus\r\n              type=\"text\"\r\n              placeholder=\"Name\"\r\n              value={this.state.newPointName}\r\n              onChange={this.handleNewPointNameChange}\r\n              ref={this.newPointNameInput}\r\n            />\r\n          </form>\r\n          <ol className=\"points-list\">\r\n            {this.state.points.map((point) => (\r\n              <li\r\n                key={point.id}\r\n                draggable\r\n                onDragStart={(e) => this.handlePointListItemDragStart(e, point)}\r\n                onDragOver={this.allowDrop}\r\n                onDrop={(e) => this.handlePointListItemDrop(point)}\r\n                onDragEnd={this.handlePointListItemDragEnd}\r\n                className=\"point\"\r\n              >\r\n                {point.name}</li>\r\n            ))}\r\n          </ol>\r\n        </div>\r\n        <div id=\"map\" className=\"map\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  handlePointListItemDragEnd = (event) => {\r\n    this._draggedPoint = null;\r\n  }\r\n\r\n  handlePointListItemDragStart = (event, draggedPoint) => {\r\n    this._draggedPoint = draggedPoint;\r\n    event.dataTransfer.setData(\"text\", \"Stub data\");\r\n    console.log(event.dataTransfer)\r\n  }\r\n\r\n  handlePointListItemDrop = (dropOntoPoint) => {\r\n    if (this._draggedPoint) {\r\n      this.setState((state, props) => {\r\n        const newStatePoints = state.points.slice();\r\n        const dropOntoPointInd = state.points.indexOf(dropOntoPoint);\r\n        const draggedPointInd = state.points.indexOf(this._draggedPoint);\r\n        newStatePoints.splice(draggedPointInd, 1);\r\n        newStatePoints.splice(dropOntoPointInd, 0, this._draggedPoint);\r\n        return { points: newStatePoints };\r\n      });\r\n    }\r\n  }\r\n\r\n  allowDrop (event) {\r\n    event.preventDefault();\r\n  }\r\n\r\n  componentDidMount() {\r\n    const ymapsInit = () => {\r\n      this.setState({mapReady: true});\r\n      this.map = new ymaps.Map(\"map\", {\r\n        center: [55.76, 37.64],\r\n        zoom: 10\r\n      });\r\n      this.ymapsRouteObj = new ymaps.Polyline([55.76, 37.64]);\r\n      this.map.geoObjects.add(this.ymapsRouteObj);\r\n      this.map.events.add(\"actionbegin\", () => {\r\n        this.newPointNameInput.current.focus();\r\n      });\r\n    };\r\n    ymaps.ready(ymapsInit);\r\n  }\r\n\r\n  handleNewPointSubmit = (event) => {\r\n    event.preventDefault();\r\n\r\n    const newPointName = this.state.newPointName;\r\n    this.setState((state, props) => {\r\n      let newStatePoints = state.points.slice();\r\n      const newPointId = this.nextPointId;\r\n      this.nextPointId++;\r\n      let newYmapsPoint = new ymaps.GeoObject({\r\n        geometry: {\r\n          type: \"Point\",\r\n          coordinates: this.map.getCenter()\r\n        },\r\n        properties: {\r\n          balloonContent: newPointName\r\n        }\r\n      }, { draggable: true }\r\n      );\r\n      newYmapsPoint.events.add(\"geometrychange\", () => {\r\n        // TODO the route flickers when we move points around. Fix it?\r\n        this.mapRefreshRoute();\r\n      });\r\n      this.map.geoObjects.add(newYmapsPoint);\r\n      newStatePoints.push(\r\n        {\r\n          id: newPointId,\r\n          name: newPointName,\r\n          ymapsObj: newYmapsPoint\r\n        }\r\n      );\r\n      return { points: newStatePoints, newPointName: \"\" };\r\n    });\r\n  }\r\n\r\nmapRefreshRoute = () => {\r\n    const routeCoordinates = [];\r\n    for (let point of this.state.points) {\r\n      // For a point, its bounds is a 0 area rectangle.\r\n      let pointCoordinates = point.ymapsObj.geometry.getBounds()[0];\r\n      routeCoordinates.push(pointCoordinates);\r\n    }\r\n    this.ymapsRouteObj.geometry.setCoordinates(routeCoordinates);\r\n  }\r\n\r\n  handleNewPointNameChange = (event) => {\r\n    this.setState({ newPointName: event.target.value });\r\n  }\r\n\r\n  componentDidUpdate (prevProps, prevState, snapshot) {\r\n    if (this.state.points !== prevState.points) {\r\n      this.mapRefreshRoute();\r\n    }\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}